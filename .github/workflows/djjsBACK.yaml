  - task: GoTool@0
      inputs:
        version: '1.24.0'
      displayName: 'Install Go 1.24 (optional)'
      continueOnError: true

    # Optional: local binary build (Docker multi-stage me bhi ho sakta hai)
    - script: |
        go build -o myapp ./cmd/main || true
      displayName: 'Build binary (optional)'

    - script: |
        docker build -t myapp:latest .
      displayName: 'Build Docker image'

    - script: |
        docker ps -q --filter "name=myapp" | grep -q . && docker stop myapp || true
        docker ps -a -q --filter "name=myapp" | grep -q . && docker rm myapp || true
      displayName: 'Stop & remove old container if present'

    - script: |
        # NOTE: Dockerfile me EXPOSE 8050 ho to 8050:8050 map karein.
        docker run -d --name myapp \
          -p 8050:8050 \
          --env-file .env.prod \
          myapp:latest
      displayName: 'Run new container'

    - script: docker image prune -af || true
      displayName: 'Prune old images'
